sap.ui.define(["sap/ui/core/mvc/Controller", "sap/ui/core/routing/History",
"sap/m/MessageToast",
"sap/m/MessageBox",
"sap/ui/core/ValueState"], 
function(Controller, History,MessageToast,MessageBox,ValueState) {
	"use strict";
	return Controller.extend("ZNav.controller.V_Gap_Create", {
		/**
		 * Called when a controller is instantiated and its View controls (if available) are already created.
		 * Can be used to modify the View before it is displayed, to bind event handlers and do other one-time initialization.
		 * @memberOf ZNav.view.V_Gap_Create
		 */
	 onInit: function() {
				// fvalidation : function()
		var oView = this.getView();
                   oView.addEventDelegate({
                onBeforeShow: function(oEvent) {
                oView.byId("idProjectId").setValue("");
                oView.byId("idGapNumber").setValue("");
                oView.byId("idGapDescription").setValue("");
                }

    }, oView);    
	 },
		/**
		 * Similar to onAfterRendering, but this hook is invoked before the controller's View is re-rendered
		 * (NOT before the first rendering! onInit() is used for that one!).
		 * @memberOf ZNav.view.V_Gap_Create
		 */
		//	onBeforeRendering: function() {
		//
		//	},
		/**
		 * Called when the View has been rendered (so its HTML is part of the document). Post-rendering manipulations of the HTML could be done here.
		 * This hook is the same one that SAPUI5 controls get after being rendered.
		 * @memberOf ZNav.view.V_Gap_Create
		 */
		//	onAfterRendering: function() {
		//
		//	},
		/**
		 * Called when the Controller is destroyed. Use this one to free resources and finalize activities.
		 * @memberOf ZNav.view.V_Gap_Create
		 */
		//	onExit: function() {
		//
		//	}
   //     fvalidation: function() {
			// {
			//     var oModel = this.getView().getModel();
			// 	var oEntry = {};
			// 	oEntry.ZprojId = this.getView().byId("idProjectId").getValue();
			// 	if (oEntry.ZprojId < 1 || oEntry.ZprojId >999 )
			// 	{
			// 	this.getView().byId("idProjectId").setValueState(sap.ui.core.ValueState.Error);	
			// 	}
			// 	else
			// 	{
			// 	this.getView().byId("idProjectId").setValueState(sap.ui.core.ValueState.None);		
			// 	}
			// }
			// },
			//  fvalidationgap  : function() {
			// {   var oModel = this.getView().getModel();
			// 	var oEntry = {};
			// 	oEntry.ZgapNo = this.getView().byId("idGapNumber").getValue();
			// 	if (oEntry.ZgapNo < 1 || oEntry.ZgapNo >999999 )
			// 	{
			// 	this.getView().byId("idGapNumber").setValueState(sap.ui.core.ValueState.Error);	
			// 	}
			// 	else
			// 	{
			// 	this.getView().byId("idGapNumber").setValueState(sap.ui.core.ValueState.None);		
			// 	}
			// }
			// },
		fGoToGapDisplay: function() {
				//This code was generated by the layout editor.
				//This code was generated by the layout editor.
				var oHistory = History.getInstance();
				var sPreviousHash = oHistory.getPreviousHash();
				// Go one screen back if you find a Hash
				if (sPreviousHash !== undefined) {
					window.history.go(-1);
				} // If you do not find a correct Hash, go to the Source screen using default router;
				else {
					var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
					oRouter.navTo("", true);
				}
			},
		fSaveGap: function() {
				// var dialog = new sap.m.BusyDialog({
				// 	text: 'Creating Record'
				// });
			/*create operation*/
			var iError = 0;
			var oModel = this.getView().getModel();
			var oEntry = {};
			var oZprojId1 = this.getView().byId("idProjectId").getSelectedItem();
			// 	if (oZprojId1  === null) {
			// 		// dialog.close();
			// 		MessageToast.show("Please enter Project ID");
			// 	}
			// 		else {
			
			 if( oZprojId1 === null  || oEntry.ZprojId < 1 ){ 
				this.getView().byId("idProjectId").setValueState(sap.ui.core.ValueState.Error);
				this.getView().byId("idProjectId").setTooltip("Pls select valid project");
				iError++;
			}
			else{
					this.getView().byId("idProjectId").setValueState(sap.ui.core.ValueState.None);
					this.getView().byId("idProjectId").destroyTooltip();
			}
			oEntry.ZgapNo = this.getView().byId("idGapNumber").getValue();
			 if(oEntry.ZgapNo === "" || oEntry.ZgapNo < 1 ){ 
				this.getView().byId("idGapNumber").setValueState(sap.ui.core.ValueState.Error);
				this.getView().byId("idGapNumber").setTooltip("Pls enter a number between 1 and 999");
				iError++;
			}
			else{
					this.getView().byId("idGapNumber").setValueState(sap.ui.core.ValueState.None);
					this.getView().byId("idGapNumber").destroyTooltip();
			}
			// if (oEntry.ZprojId === "") {
			// 		// dialog.close();
			// 		MessageToast.show("Please enter Project ID");
			// 	} else if (oEntry.ZgapNo === "") {
			// 		// dialog.close();
			// 		MessageToast.show("Please enter Gap Number");
			// 	} else
			 	if (iError > 0){ 
				return;
			}
			else {
		    var oKey = oZprojId1.getKey();
            oEntry.ZprojId = oKey;
			oEntry.Zgapdesc = this.getView().byId("idGapDescription").getValue();
			oModel.create("/GapMasterSet", oEntry, {
				method: "POST",
		     	success: function(data) {
							// dialog.close();
							MessageBox.success("Record has been succesfully created");
							var oHistory = History.getInstance();
							var sPreviousHash = oHistory.getPreviousHash();
							if (sPreviousHash !== undefined) {
								window.history.go(-1);
							} // If you do not find a correct Hash, go to the Source screen using default router;
							else {
								var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
								oRouter.navTo("", true);
							}
						},
						error: function(e) {
							// dialog.close();
							MessageBox.error("Entry already exist");
						}
					});
				
				}
}
		});
	});
		/**
		 *@memberOf ZNav.controller.V_Gap_Create
		 */